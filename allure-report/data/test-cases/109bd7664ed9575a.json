{"uid":"109bd7664ed9575a","name":"test_delete_resource_unit_measure_by_id","fullName":"tests.resource.resource_units_measure.test_resource_units_measure_delete#test_delete_resource_unit_measure_by_id","historyId":"2263e5dd842d3816e14dddabaa42b154","time":{"start":1755556055786,"stop":1755556057374,"duration":1588},"description":"\nТест удаления единицы измерения через DELETE /api/v1/resource_unit_measure/{id}\nПроверяет:\n1. Доступность endpoint (не 404 и не 500 с 'method - not found')\n2. Успешный статус (200 или 204)\n3. Проверку отсутствия ресурса после удаления\n","descriptionHtml":"<p>Тест удаления единицы измерения через DELETE /api/v1/resource_unit_measure/{id}<br />\nПроверяет:</p>\n<ol>\n<li>Доступность endpoint (не 404 и не 500 с 'method - not found')</li>\n<li>Успешный статус (200 или 204)</li>\n<li>Проверку отсутствия ресурса после удаления</li>\n</ol>\n","status":"failed","statusMessage":"AssertionError: Ошибка при удалении единицы измерения. Статус: 404, Ответ: {\"error\":\"unit not found\"}\nassert 404 in [200, 204]\n +  where 404 = <Response [404]>.status_code","statusTrace":"@allure.story(\"Удаление единицы измерения по ID (DELETE)\")\n    def test_delete_resource_unit_measure_by_id():\n        \"\"\"\n        Тест удаления единицы измерения через DELETE /api/v1/resource_unit_measure/{id}\n        Проверяет:\n        1. Доступность endpoint (не 404 и не 500 с 'method - not found')\n        2. Успешный статус (200 или 204)\n        3. Проверку отсутствия ресурса после удаления\n        \"\"\"\n        with allure.step(\"Загрузка переменных окружения\"):\n            load_dotenv(ENV_FILE)\n    \n        with allure.step(\"Чтение параметров из .env\"):\n            base_url = os.getenv(\"API_URL\")\n            login = os.getenv(\"API_LOGIN\")\n            password = os.getenv(\"API_PASSWORD\")\n            domain = os.getenv(\"API_DOMAIN\")\n            unit_id = os.getenv(\"RESOURCE_UNIT_MEASURE_ID\", \"123112\")  # Можно задать в .env\n    \n        with allure.step(\"Проверка обязательных переменных окружения\"):\n            assert base_url, \"API_URL не задан в .env\"\n            assert login, \"API_LOGIN не задан в .env\"\n            assert password, \"API_PASSWORD не задан в .env\"\n            assert domain, \"API_DOMAIN не задан в .env\"\n            assert unit_id, \"RESOURCE_UNIT_MEASURE_ID не задан\"\n    \n        try:\n            unit_id = int(unit_id)\n            assert unit_id > 0, \"ID единицы измерения должен быть положительным числом\"\n        except (ValueError, TypeError):\n            pytest.skip(\"RESOURCE_UNIT_MEASURE_ID должен быть целым положительным числом\")\n    \n        with allure.step(\"Получение токена аутентификации\"):\n            token = get_auth_token(login, password, 600, domain)\n            assert token, \"Не удалось получить токен аутентификации\"\n    \n        # === Проверка доступности endpoint: отправляем GET или DELETE с \"холодным\" запросом ===\n        with allure.step(\"Проверка доступности метода DELETE (предварительная проверка)\"):\n            probe_url = f\"{base_url}/api/v1/resource_unit_measure/{unit_id}\"\n            probe_headers = {\n                \"accept\": \"application/json\",\n                \"tockenid\": token\n            }\n    \n            # Отправляем запрос с методом DELETE, но без ожидания удаления — просто проверяем, доступен ли метод\n            probe_response = requests.request(\"DELETE\", probe_url, headers=probe_headers, json={})\n    \n            allure.attach(\n                str(probe_response.status_code),\n                name=\"Код статуса пробного запроса\",\n                attachment_type=AttachmentType.TEXT\n            )\n            allure.attach(\n                str(probe_response.text),\n                name=\"Тело ответа на пробный запрос\",\n                attachment_type=AttachmentType.TEXT\n            )\n    \n            # Обработка 500 с \"method - not found\"\n            if probe_response.status_code == 500:\n                try:\n                    error_data = probe_response.json()\n                    if error_data.get(\"error\") == \"method - not found\":\n                        allure.attach(\n                            str(error_data),\n                            name=\"Ошибка сервера\",\n                            attachment_type=AttachmentType.JSON\n                        )\n                        pytest.skip(\n                            f\"Метод DELETE недоступен: 'method - not found'. \"\n                            f\"Возможно, endpoint не реализован или опечатка в URL. \"\n                            f\"Детали: {error_data.get('error_launcher', 'не указаны')}\"\n                        )\n                except ValueError:\n                    pytest.skip(\"Сервер вернул 500, но ответ не в формате JSON\")\n    \n            # Проверка 404 на уровне самого endpoint (не ресурса, а метода)\n            if probe_response.status_code == 404:\n                try:\n                    error_data = probe_response.json()\n                    if error_data.get(\"error\") == \"method - not found\":\n                        pytest.skip(\"Endpoint не найден: метод удаления не реализован на сервере\")\n                except ValueError:\n                    pass  # Тело не JSON — всё равно критично\n                pytest.skip(\"Endpoint DELETE /resource_unit_measure/{id} вернул 404 — возможно, маршрут не существует\")\n    \n        # === Основной запрос на удаление ===\n        with allure.step(f\"Формирование URL для удаления единицы измерения (ID={unit_id})\"):\n            url = f\"{base_url}/api/v1/resource_unit_measure/{unit_id}\"\n            headers = {\n                \"accept\": \"*/*\",\n                \"tockenid\": token\n            }\n            allure.attach(url, name=\"URL запроса\", attachment_type=AttachmentType.TEXT)\n            allure.attach(str(headers), name=\"Заголовки запроса\", attachment_type=AttachmentType.JSON)\n    \n        with allure.step(\"Отправка DELETE-запроса\"):\n            response = requests.delete(url, headers=headers)\n            allure.attach(str(response.status_code), name=\"Код статуса ответа\", attachment_type=AttachmentType.TEXT)\n            allure.attach(str(response.text), name=\"Тело ответа\", attachment_type=AttachmentType.TEXT)\n            allure.attach(str(response.headers), name=\"Заголовки ответа\", attachment_type=AttachmentType.JSON)\n    \n        with allure.step(\"Проверка статуса ответа\"):\n>           assert response.status_code in [200, 204], (\n                f\"Ошибка при удалении единицы измерения. \"\n                f\"Статус: {response.status_code}, Ответ: {response.text}\"\n            )\nE           AssertionError: Ошибка при удалении единицы измерения. Статус: 404, Ответ: {\"error\":\"unit not found\"}\nE           assert 404 in [200, 204]\nE            +  where 404 = <Response [404]>.status_code\n\ntests\\resource\\resource_units_measure\\test_resource_units_measure_delete.py:148: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1755555996538,"stop":1755555996539,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false}],"testStage":{"description":"\nТест удаления единицы измерения через DELETE /api/v1/resource_unit_measure/{id}\nПроверяет:\n1. Доступность endpoint (не 404 и не 500 с 'method - not found')\n2. Успешный статус (200 или 204)\n3. Проверку отсутствия ресурса после удаления\n","status":"failed","statusMessage":"AssertionError: Ошибка при удалении единицы измерения. Статус: 404, Ответ: {\"error\":\"unit not found\"}\nassert 404 in [200, 204]\n +  where 404 = <Response [404]>.status_code","statusTrace":"@allure.story(\"Удаление единицы измерения по ID (DELETE)\")\n    def test_delete_resource_unit_measure_by_id():\n        \"\"\"\n        Тест удаления единицы измерения через DELETE /api/v1/resource_unit_measure/{id}\n        Проверяет:\n        1. Доступность endpoint (не 404 и не 500 с 'method - not found')\n        2. Успешный статус (200 или 204)\n        3. Проверку отсутствия ресурса после удаления\n        \"\"\"\n        with allure.step(\"Загрузка переменных окружения\"):\n            load_dotenv(ENV_FILE)\n    \n        with allure.step(\"Чтение параметров из .env\"):\n            base_url = os.getenv(\"API_URL\")\n            login = os.getenv(\"API_LOGIN\")\n            password = os.getenv(\"API_PASSWORD\")\n            domain = os.getenv(\"API_DOMAIN\")\n            unit_id = os.getenv(\"RESOURCE_UNIT_MEASURE_ID\", \"123112\")  # Можно задать в .env\n    \n        with allure.step(\"Проверка обязательных переменных окружения\"):\n            assert base_url, \"API_URL не задан в .env\"\n            assert login, \"API_LOGIN не задан в .env\"\n            assert password, \"API_PASSWORD не задан в .env\"\n            assert domain, \"API_DOMAIN не задан в .env\"\n            assert unit_id, \"RESOURCE_UNIT_MEASURE_ID не задан\"\n    \n        try:\n            unit_id = int(unit_id)\n            assert unit_id > 0, \"ID единицы измерения должен быть положительным числом\"\n        except (ValueError, TypeError):\n            pytest.skip(\"RESOURCE_UNIT_MEASURE_ID должен быть целым положительным числом\")\n    \n        with allure.step(\"Получение токена аутентификации\"):\n            token = get_auth_token(login, password, 600, domain)\n            assert token, \"Не удалось получить токен аутентификации\"\n    \n        # === Проверка доступности endpoint: отправляем GET или DELETE с \"холодным\" запросом ===\n        with allure.step(\"Проверка доступности метода DELETE (предварительная проверка)\"):\n            probe_url = f\"{base_url}/api/v1/resource_unit_measure/{unit_id}\"\n            probe_headers = {\n                \"accept\": \"application/json\",\n                \"tockenid\": token\n            }\n    \n            # Отправляем запрос с методом DELETE, но без ожидания удаления — просто проверяем, доступен ли метод\n            probe_response = requests.request(\"DELETE\", probe_url, headers=probe_headers, json={})\n    \n            allure.attach(\n                str(probe_response.status_code),\n                name=\"Код статуса пробного запроса\",\n                attachment_type=AttachmentType.TEXT\n            )\n            allure.attach(\n                str(probe_response.text),\n                name=\"Тело ответа на пробный запрос\",\n                attachment_type=AttachmentType.TEXT\n            )\n    \n            # Обработка 500 с \"method - not found\"\n            if probe_response.status_code == 500:\n                try:\n                    error_data = probe_response.json()\n                    if error_data.get(\"error\") == \"method - not found\":\n                        allure.attach(\n                            str(error_data),\n                            name=\"Ошибка сервера\",\n                            attachment_type=AttachmentType.JSON\n                        )\n                        pytest.skip(\n                            f\"Метод DELETE недоступен: 'method - not found'. \"\n                            f\"Возможно, endpoint не реализован или опечатка в URL. \"\n                            f\"Детали: {error_data.get('error_launcher', 'не указаны')}\"\n                        )\n                except ValueError:\n                    pytest.skip(\"Сервер вернул 500, но ответ не в формате JSON\")\n    \n            # Проверка 404 на уровне самого endpoint (не ресурса, а метода)\n            if probe_response.status_code == 404:\n                try:\n                    error_data = probe_response.json()\n                    if error_data.get(\"error\") == \"method - not found\":\n                        pytest.skip(\"Endpoint не найден: метод удаления не реализован на сервере\")\n                except ValueError:\n                    pass  # Тело не JSON — всё равно критично\n                pytest.skip(\"Endpoint DELETE /resource_unit_measure/{id} вернул 404 — возможно, маршрут не существует\")\n    \n        # === Основной запрос на удаление ===\n        with allure.step(f\"Формирование URL для удаления единицы измерения (ID={unit_id})\"):\n            url = f\"{base_url}/api/v1/resource_unit_measure/{unit_id}\"\n            headers = {\n                \"accept\": \"*/*\",\n                \"tockenid\": token\n            }\n            allure.attach(url, name=\"URL запроса\", attachment_type=AttachmentType.TEXT)\n            allure.attach(str(headers), name=\"Заголовки запроса\", attachment_type=AttachmentType.JSON)\n    \n        with allure.step(\"Отправка DELETE-запроса\"):\n            response = requests.delete(url, headers=headers)\n            allure.attach(str(response.status_code), name=\"Код статуса ответа\", attachment_type=AttachmentType.TEXT)\n            allure.attach(str(response.text), name=\"Тело ответа\", attachment_type=AttachmentType.TEXT)\n            allure.attach(str(response.headers), name=\"Заголовки ответа\", attachment_type=AttachmentType.JSON)\n    \n        with allure.step(\"Проверка статуса ответа\"):\n>           assert response.status_code in [200, 204], (\n                f\"Ошибка при удалении единицы измерения. \"\n                f\"Статус: {response.status_code}, Ответ: {response.text}\"\n            )\nE           AssertionError: Ошибка при удалении единицы измерения. Статус: 404, Ответ: {\"error\":\"unit not found\"}\nE           assert 404 in [200, 204]\nE            +  where 404 = <Response [404]>.status_code\n\ntests\\resource\\resource_units_measure\\test_resource_units_measure_delete.py:148: AssertionError","steps":[{"name":"Загрузка переменных окружения","time":{"start":1755556055786,"stop":1755556055790,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false},{"name":"Чтение параметров из .env","time":{"start":1755556055790,"stop":1755556055790,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false},{"name":"Проверка обязательных переменных окружения","time":{"start":1755556055790,"stop":1755556055790,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false},{"name":"Получение токена аутентификации","time":{"start":1755556055790,"stop":1755556056275,"duration":485},"status":"passed","steps":[{"name":"Отправка запроса для получения токена","time":{"start":1755556055790,"stop":1755556056274,"duration":484},"status":"passed","steps":[],"attachments":[{"uid":"1985c36c400e5cff","name":"URL запроса","source":"1985c36c400e5cff.txt","type":"text/plain","size":48},{"uid":"33e47c89ddfa598","name":"Заголовки запроса","source":"33e47c89ddfa598.txt","type":"text/plain","size":30},{"uid":"2bc8771b340346be","name":"Параметры запроса","source":"2bc8771b340346be.txt","type":"text/plain","size":97},{"uid":"81ec1a4b6c3a05f7","name":"Код статуса ответа","source":"81ec1a4b6c3a05f7.txt","type":"text/plain","size":3},{"uid":"93ce772c91d5be78","name":"Заголовки ответа","source":"93ce772c91d5be78.txt","type":"text/plain","size":377},{"uid":"a266d67d66a36522","name":"Тело ответа","source":"a266d67d66a36522.txt","type":"text/plain","size":462}],"parameters":[],"attachmentsCount":6,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":true}],"attachments":[],"parameters":[],"attachmentsCount":6,"shouldDisplayMessage":false,"stepsCount":1,"attachmentStep":false,"hasContent":true},{"name":"Проверка доступности метода DELETE (предварительная проверка)","time":{"start":1755556056275,"stop":1755556056779,"duration":504},"status":"passed","steps":[],"attachments":[{"uid":"ca8b71c4ca9eed0e","name":"Код статуса пробного запроса","source":"ca8b71c4ca9eed0e.txt","type":"text/plain","size":3},{"uid":"8b376bbcc213afa","name":"Тело ответа на пробный запрос","source":"8b376bbcc213afa.txt","type":"text/plain","size":149}],"parameters":[],"attachmentsCount":2,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":true},{"name":"Формирование URL для удаления единицы измерения (ID=123112)","time":{"start":1755556056779,"stop":1755556056780,"duration":1},"status":"passed","steps":[],"attachments":[{"uid":"b5ac63250cccee03","name":"URL запроса","source":"b5ac63250cccee03.txt","type":"text/plain","size":65},{"uid":"333acdca2803143f","name":"Заголовки запроса","source":"333acdca2803143f.json","type":"application/json","size":480}],"parameters":[],"attachmentsCount":2,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":true},{"name":"Отправка DELETE-запроса","time":{"start":1755556056780,"stop":1755556057373,"duration":593},"status":"passed","steps":[],"attachments":[{"uid":"404aaed60caa372c","name":"Код статуса ответа","source":"404aaed60caa372c.txt","type":"text/plain","size":3},{"uid":"1e922727cfa8636d","name":"Тело ответа","source":"1e922727cfa8636d.txt","type":"text/plain","size":26},{"uid":"8c96f1e9cafab9ec","name":"Заголовки ответа","source":"8c96f1e9cafab9ec.json","type":"application/json","size":376}],"parameters":[],"attachmentsCount":3,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":true},{"name":"Проверка статуса ответа","time":{"start":1755556057373,"stop":1755556057373,"duration":0},"status":"failed","statusMessage":"AssertionError: Ошибка при удалении единицы измерения. Статус: 404, Ответ: {\"error\":\"unit not found\"}\nassert 404 in [200, 204]\n +  where 404 = <Response [404]>.status_code\n","statusTrace":"  File \"D:\\project\\autotest\\tests\\resource\\resource_units_measure\\test_resource_units_measure_delete.py\", line 148, in test_delete_resource_unit_measure_by_id\n    assert response.status_code in [200, 204], (\n    ...<2 lines>...\n    )\n","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":true,"stepsCount":0,"attachmentStep":false,"hasContent":true}],"attachments":[],"parameters":[],"attachmentsCount":13,"shouldDisplayMessage":true,"stepsCount":9,"attachmentStep":false,"hasContent":true},"afterStages":[],"labels":[{"name":"story","value":"Удаление единицы измерения по ID (DELETE)"},{"name":"parentSuite","value":"tests.resource.resource_units_measure"},{"name":"suite","value":"test_resource_units_measure_delete"},{"name":"host","value":"MSI"},{"name":"thread","value":"55080-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.resource.resource_units_measure.test_resource_units_measure_delete"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"109bd7664ed9575a.json","parameterValues":[]}