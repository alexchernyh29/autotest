{"uid":"524b4b7d1e8a577c","name":"test_get_tariff_links_organization_filtered[by_location_id]","fullName":"tests.tariff.tariff_links_organization.test_tariff_links_organization_read#test_get_tariff_links_organization_filtered","historyId":"f1295a502ec48ccdea0755457256c4ca","time":{"start":1755466612653,"stop":1755466613484,"duration":831},"description":"\nПараметризованный тест: получение связей тарифов с организациями\nпо каждому фильтру по отдельности.\n","descriptionHtml":"<p>Параметризованный тест: получение связей тарифов с организациями<br />\nпо каждому фильтру по отдельности.</p>\n","status":"failed","statusMessage":"AssertionError: Ни одна из 19 связей не соответствует фильтру: by_location_id=125\nassert False","statusTrace":"filter_key = 'by_location_id', filter_value = 125\n\n    @allure.feature(\"Фильтрация связей тарифов с организациями\")\n    @pytest.mark.parametrize(\n        \"filter_key, filter_value\",\n        [\n            (\"by_tenant_id\", FILTERS[\"by_tenant_id\"]),\n            (\"by_tariff_id\", FILTERS[\"by_tariff_id\"]),\n            (\"by_name\", FILTERS[\"by_name\"]),\n            (\"by_service_id\", FILTERS[\"by_service_id\"]),\n            (\"by_location_id\", FILTERS[\"by_location_id\"])\n        ],\n        ids=[\n            \"by_tenant_id\",\n            \"by_tariff_id\",\n            \"by_name\",\n            \"by_service_id\",\n            \"by_location_id\"\n        ]\n    )\n    def test_get_tariff_links_organization_filtered(filter_key, filter_value):\n        \"\"\"\n        Параметризованный тест: получение связей тарифов с организациями\n        по каждому фильтру по отдельности.\n        \"\"\"\n        with allure.step(\"Подготовка тестовых данных\"):\n            load_dotenv(ENV_FILE)\n            base_url = os.getenv(\"API_URL\")\n            token = os.getenv(\"TOKEN_ID\")\n    \n            assert base_url, \"API_URL не задан в .env\"\n            assert token, \"TOKEN_ID не задан в .env\"\n    \n        # Формируем фильтр — только один параметр за раз\n        params = {filter_key: filter_value}\n    \n        url = f\"{base_url}/api/v1/tariff_links_organization\"\n        headers = {\n            \"accept\": \"application/json\",\n            \"tockenid\": token\n        }\n    \n        with allure.step(f\"Отправка GET-запроса с фильтром: {filter_key}={filter_value}\"):\n            # Генерация cURL\n            curl_command = (\n                f\"curl -X GET '{url}?{filter_key}={filter_value}' \"\n                f\"-H 'accept: application/json' \"\n                f\"-H 'tockenid: {token}'\"\n            )\n            allure.attach(curl_command, \"CURL команда\", allure.attachment_type.TEXT)\n    \n            allure.attach(\n                json.dumps(params, ensure_ascii=False, indent=2),\n                \"Query Parameters\",\n                allure.attachment_type.JSON\n            )\n    \n            allure.attach(\n                json.dumps(headers, ensure_ascii=False, indent=2),\n                \"Request Headers\",\n                allure.attachment_type.JSON\n            )\n    \n            response = requests.get(url, params=params, headers=headers)\n    \n        with allure.step(\"Проверка ответа\"):\n            allure.attach(f\"Финальный URL: {response.url}\", \"Использованный URL\", allure.attachment_type.TEXT)\n            allure.attach(\n                f\"Status Code: {response.status_code}\\nResponse: {response.text}\",\n                \"Response Details\",\n                allure.attachment_type.TEXT\n            )\n    \n            assert response.status_code == 200, f\"Ожидался 200, получен {response.status_code}\"\n    \n            try:\n                links_list = response.json()\n            except ValueError:\n                pytest.fail(\"Ответ не является валидным JSON\")\n    \n            allure.attach(\n                json.dumps(links_list, ensure_ascii=False, indent=2),\n                \"Response (tariff_links_organization list)\",\n                allure.attachment_type.JSON\n            )\n    \n            assert isinstance(links_list, list), \"Ожидался массив связей\"\n    \n            # Проверяем, что хотя бы одна связь соответствует фильтру\n            with allure.step(\"Проверка структуры и соответствия фильтру\"):\n                if len(links_list) == 0:\n                    allure.attach(\n                        f\"Список пуст. Фильтр: {filter_key}={filter_value}\",\n                        \"Внимание\",\n                        allure.attachment_type.TEXT\n                    )\n                    pytest.fail(f\"Ожидались данные по фильтру {filter_key}={filter_value}, но список пуст\")\n    \n                found_match = False\n                for link in links_list:\n                    assert isinstance(link, dict), \"Каждая связь должна быть объектом\"\n                    assert \"id\" in link\n                    assert \"tariff_id\" in link\n                    assert \"tenant_id\" in link\n                    assert \"name\" in link\n    \n                    # Проверяем соответствие текущему фильтру\n                    if filter_key == \"by_tenant_id\" and link[\"tenant_id\"] == filter_value:\n                        found_match = True\n                    elif filter_key == \"by_tariff_id\" and link[\"tariff_id\"] == filter_value:\n                        found_match = True\n                    elif filter_key == \"by_name\" and filter_value in str(link[\"name\"]):\n                        found_match = True\n                    elif filter_key == \"by_service_id\" and \"service_id\" in link and link[\"service_id\"] == filter_value:\n                        found_match = True\n                    elif filter_key == \"by_location_id\" and \"location_id\" in link and link[\"location_id\"] == filter_value:\n                        found_match = True\n    \n>               assert found_match, f\"Ни одна из {len(links_list)} связей не соответствует фильтру: {filter_key}={filter_value}\"\nE               AssertionError: Ни одна из 19 связей не соответствует фильтру: by_location_id=125\nE               assert False\n\ntests\\tariff\\tariff_links_organization\\test_tariff_links_organization_read.py:142: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1755466542655,"stop":1755466542656,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false}],"testStage":{"description":"\nПараметризованный тест: получение связей тарифов с организациями\nпо каждому фильтру по отдельности.\n","status":"failed","statusMessage":"AssertionError: Ни одна из 19 связей не соответствует фильтру: by_location_id=125\nassert False","statusTrace":"filter_key = 'by_location_id', filter_value = 125\n\n    @allure.feature(\"Фильтрация связей тарифов с организациями\")\n    @pytest.mark.parametrize(\n        \"filter_key, filter_value\",\n        [\n            (\"by_tenant_id\", FILTERS[\"by_tenant_id\"]),\n            (\"by_tariff_id\", FILTERS[\"by_tariff_id\"]),\n            (\"by_name\", FILTERS[\"by_name\"]),\n            (\"by_service_id\", FILTERS[\"by_service_id\"]),\n            (\"by_location_id\", FILTERS[\"by_location_id\"])\n        ],\n        ids=[\n            \"by_tenant_id\",\n            \"by_tariff_id\",\n            \"by_name\",\n            \"by_service_id\",\n            \"by_location_id\"\n        ]\n    )\n    def test_get_tariff_links_organization_filtered(filter_key, filter_value):\n        \"\"\"\n        Параметризованный тест: получение связей тарифов с организациями\n        по каждому фильтру по отдельности.\n        \"\"\"\n        with allure.step(\"Подготовка тестовых данных\"):\n            load_dotenv(ENV_FILE)\n            base_url = os.getenv(\"API_URL\")\n            token = os.getenv(\"TOKEN_ID\")\n    \n            assert base_url, \"API_URL не задан в .env\"\n            assert token, \"TOKEN_ID не задан в .env\"\n    \n        # Формируем фильтр — только один параметр за раз\n        params = {filter_key: filter_value}\n    \n        url = f\"{base_url}/api/v1/tariff_links_organization\"\n        headers = {\n            \"accept\": \"application/json\",\n            \"tockenid\": token\n        }\n    \n        with allure.step(f\"Отправка GET-запроса с фильтром: {filter_key}={filter_value}\"):\n            # Генерация cURL\n            curl_command = (\n                f\"curl -X GET '{url}?{filter_key}={filter_value}' \"\n                f\"-H 'accept: application/json' \"\n                f\"-H 'tockenid: {token}'\"\n            )\n            allure.attach(curl_command, \"CURL команда\", allure.attachment_type.TEXT)\n    \n            allure.attach(\n                json.dumps(params, ensure_ascii=False, indent=2),\n                \"Query Parameters\",\n                allure.attachment_type.JSON\n            )\n    \n            allure.attach(\n                json.dumps(headers, ensure_ascii=False, indent=2),\n                \"Request Headers\",\n                allure.attachment_type.JSON\n            )\n    \n            response = requests.get(url, params=params, headers=headers)\n    \n        with allure.step(\"Проверка ответа\"):\n            allure.attach(f\"Финальный URL: {response.url}\", \"Использованный URL\", allure.attachment_type.TEXT)\n            allure.attach(\n                f\"Status Code: {response.status_code}\\nResponse: {response.text}\",\n                \"Response Details\",\n                allure.attachment_type.TEXT\n            )\n    \n            assert response.status_code == 200, f\"Ожидался 200, получен {response.status_code}\"\n    \n            try:\n                links_list = response.json()\n            except ValueError:\n                pytest.fail(\"Ответ не является валидным JSON\")\n    \n            allure.attach(\n                json.dumps(links_list, ensure_ascii=False, indent=2),\n                \"Response (tariff_links_organization list)\",\n                allure.attachment_type.JSON\n            )\n    \n            assert isinstance(links_list, list), \"Ожидался массив связей\"\n    \n            # Проверяем, что хотя бы одна связь соответствует фильтру\n            with allure.step(\"Проверка структуры и соответствия фильтру\"):\n                if len(links_list) == 0:\n                    allure.attach(\n                        f\"Список пуст. Фильтр: {filter_key}={filter_value}\",\n                        \"Внимание\",\n                        allure.attachment_type.TEXT\n                    )\n                    pytest.fail(f\"Ожидались данные по фильтру {filter_key}={filter_value}, но список пуст\")\n    \n                found_match = False\n                for link in links_list:\n                    assert isinstance(link, dict), \"Каждая связь должна быть объектом\"\n                    assert \"id\" in link\n                    assert \"tariff_id\" in link\n                    assert \"tenant_id\" in link\n                    assert \"name\" in link\n    \n                    # Проверяем соответствие текущему фильтру\n                    if filter_key == \"by_tenant_id\" and link[\"tenant_id\"] == filter_value:\n                        found_match = True\n                    elif filter_key == \"by_tariff_id\" and link[\"tariff_id\"] == filter_value:\n                        found_match = True\n                    elif filter_key == \"by_name\" and filter_value in str(link[\"name\"]):\n                        found_match = True\n                    elif filter_key == \"by_service_id\" and \"service_id\" in link and link[\"service_id\"] == filter_value:\n                        found_match = True\n                    elif filter_key == \"by_location_id\" and \"location_id\" in link and link[\"location_id\"] == filter_value:\n                        found_match = True\n    \n>               assert found_match, f\"Ни одна из {len(links_list)} связей не соответствует фильтру: {filter_key}={filter_value}\"\nE               AssertionError: Ни одна из 19 связей не соответствует фильтру: by_location_id=125\nE               assert False\n\ntests\\tariff\\tariff_links_organization\\test_tariff_links_organization_read.py:142: AssertionError","steps":[{"name":"Подготовка тестовых данных","time":{"start":1755466612653,"stop":1755466612656,"duration":3},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false},{"name":"Отправка GET-запроса с фильтром: by_location_id=125","time":{"start":1755466612656,"stop":1755466613478,"duration":822},"status":"passed","steps":[],"attachments":[{"uid":"8976f66e43e8eb9e","name":"CURL команда","source":"8976f66e43e8eb9e.txt","type":"text/plain","size":588},{"uid":"844ca8cf2736dbcb","name":"Query Parameters","source":"844ca8cf2736dbcb.json","type":"application/json","size":27},{"uid":"c55dd01f131f6dde","name":"Request Headers","source":"c55dd01f131f6dde.json","type":"application/json","size":499}],"parameters":[],"attachmentsCount":3,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":true},{"name":"Проверка ответа","time":{"start":1755466613478,"stop":1755466613483,"duration":5},"status":"failed","statusMessage":"AssertionError: Ни одна из 19 связей не соответствует фильтру: by_location_id=125\nassert False\n","statusTrace":"  File \"C:\\Users\\annal_e209e90\\OneDrive\\Рабочий стол\\test\\corpsoft\\tests\\tariff\\tariff_links_organization\\test_tariff_links_organization_read.py\", line 142, in test_get_tariff_links_organization_filtered\n    assert found_match, f\"Ни одна из {len(links_list)} связей не соответствует фильтру: {filter_key}={filter_value}\"\n","steps":[{"name":"Проверка структуры и соответствия фильтру","time":{"start":1755466613482,"stop":1755466613483,"duration":1},"status":"failed","statusMessage":"AssertionError: Ни одна из 19 связей не соответствует фильтру: by_location_id=125\nassert False\n","statusTrace":"  File \"C:\\Users\\annal_e209e90\\OneDrive\\Рабочий стол\\test\\corpsoft\\tests\\tariff\\tariff_links_organization\\test_tariff_links_organization_read.py\", line 142, in test_get_tariff_links_organization_filtered\n    assert found_match, f\"Ни одна из {len(links_list)} связей не соответствует фильтру: {filter_key}={filter_value}\"\n","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":true,"stepsCount":0,"attachmentStep":false,"hasContent":true}],"attachments":[{"uid":"466bc391fdd941f0","name":"Использованный URL","source":"466bc391fdd941f0.txt","type":"text/plain","size":105},{"uid":"fc1de091d2fd3b0a","name":"Response Details","source":"fc1de091d2fd3b0a.txt","type":"text/plain","size":66887},{"uid":"b73389f9707211c","name":"Response (tariff_links_organization list)","source":"b73389f9707211c.json","type":"application/json","size":69569}],"parameters":[],"attachmentsCount":3,"shouldDisplayMessage":false,"stepsCount":1,"attachmentStep":false,"hasContent":true}],"attachments":[],"parameters":[],"attachmentsCount":6,"shouldDisplayMessage":true,"stepsCount":4,"attachmentStep":false,"hasContent":true},"afterStages":[],"labels":[{"name":"feature","value":"Фильтрация связей тарифов с организациями"},{"name":"parentSuite","value":"tests.tariff.tariff_links_organization"},{"name":"suite","value":"test_tariff_links_organization_read"},{"name":"host","value":"Lapochka"},{"name":"thread","value":"12236-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.tariff.tariff_links_organization.test_tariff_links_organization_read"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"filter_key","value":"'by_location_id'"},{"name":"filter_value","value":"125"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"524b4b7d1e8a577c.json","parameterValues":["'by_location_id'","125"]}